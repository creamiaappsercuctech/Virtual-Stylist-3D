<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>SerCucTech • Virtual Stylist 3D (No-404)</title>
  <meta name="theme-color" content="#111111" />
  <style>
    :root{
      --bg:#0b0b0e; --txt:#f2f2f5; --muted:#a9a9b6; --line:#2a2a3a;
      --acc:#ffd56a; --ok:#6effa8; --bad:#ff6e6e;
      font-family: system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
    }
    body{ margin:0; background: var(--bg); color:var(--txt); }
    header{ position:sticky; top:0; z-index:10; background:rgba(11,11,14,.85); backdrop-filter:blur(10px); border-bottom:1px solid rgba(255,255,255,.06); }
    .wrap{ max-width:1100px; margin:0 auto; padding:14px; }
    .row{ display:flex; gap:10px; flex-wrap:wrap; align-items:center; }
    .btn{ border:1px solid rgba(255,255,255,.1); background:rgba(255,255,255,.04); color:var(--txt); padding:10px 12px; border-radius:14px; cursor:pointer; }
    .btn.primary{ background: rgba(255,213,106,.14); border-color: rgba(255,213,106,.25); }
    .card{ border:1px solid rgba(255,255,255,.07); background:rgba(255,255,255,.02); border-radius:18px; overflow:hidden; }
    .card h2{ margin:0; font-size:14px; padding:12px 14px; border-bottom:1px solid rgba(255,255,255,.06); display:flex; justify-content:space-between; }
    .card .body{ padding:12px 14px; }
    .grid{ display:grid; grid-template-columns: 1.1fr .9fr; gap:14px; }
    @media(max-width:980px){ .grid{ grid-template-columns:1fr; } }
    label{ display:block; font-size:12px; color:var(--muted); margin:8px 0 6px; }
    input[type="number"], input[type="text"], input[type="range"]{
      width:100%; padding:10px; border-radius:12px; border:1px solid rgba(255,255,255,.08);
      background:rgba(255,255,255,.03); color:var(--txt); outline:none; box-sizing:border-box;
    }
    .pill{ display:inline-flex; gap:8px; align-items:center; padding:6px 10px; border-radius:999px;
      border:1px solid rgba(255,255,255,.08); background:rgba(255,255,255,.03); color:var(--muted); font-size:12px; }
    .pill b{ color:var(--txt); }
    #threeWrap{ height:520px; background:#090911; border-radius:16px; border:1px solid rgba(255,255,255,.06); overflow:hidden; position:relative; }
    @media(max-width:980px){ #threeWrap{ height:420px; } }
    .hint{ color:var(--muted); font-size:12px; line-height:1.35; }
    #errBox{
      position:fixed; left:10px; right:10px; bottom:10px; z-index:99;
      border:1px solid rgba(255,110,110,.35); background: rgba(255,110,110,.08);
      color: rgba(255,255,255,.95); border-radius:14px; padding:10px 12px;
      display:none; white-space:pre-wrap; font-size:12px;
    }
  </style>
</head>
<body>
<header>
  <div class="wrap row" style="justify-content:space-between">
    <div class="row">
      <div style="width:36px;height:36px;border-radius:14px;display:grid;place-items:center;background:linear-gradient(135deg,rgba(255,213,106,.95),rgba(110,255,168,.35));color:#111;font-weight:900">SC</div>
      <div>
        <div style="font-weight:800">SerCucTech • Virtual Stylist 3D</div>
        <div class="hint">Versione “No-404”: avatar sempre visibile (nessun .glb richiesto)</div>
      </div>
    </div>
    <div class="row">
      <span class="pill">Stato: <b id="status">Avvio…</b></span>
    </div>
  </div>
</header>

<main class="wrap">
  <div class="grid">
    <div class="card">
      <h2><span>Controlli avatar</span><span class="hint">drag = ruota</span></h2>
      <div class="body">
        <div id="threeWrap"></div>

        <div style="height:10px"></div>
        <div class="row">
          <div style="flex:1 1 240px; min-width:220px">
            <label>Spalle (cm)</label>
            <input id="slShoulders" type="range" min="34" max="56" value="44" />
            <span class="pill">Spalle: <b id="vShoulders">44</b> cm</span>
          </div>
          <div style="flex:1 1 240px; min-width:220px">
            <label>Vita (cm)</label>
            <input id="slWaist" type="range" min="60" max="120" value="86" />
            <span class="pill">Vita: <b id="vWaist">86</b> cm</span>
          </div>
        </div>

        <div style="height:10px"></div>
        <div class="row">
          <button class="btn primary" id="btnReset">↩️ Reset</button>
          <span class="pill">Se vedi nero: <b>WebGL/JS bloccato</b></span>
        </div>
      </div>
    </div>

    <div class="card">
      <h2><span>Debug rapido</span><span class="hint">per eliminare difetti</span></h2>
      <div class="body hint" id="debug">
        1) Se questa pagina è 404 → GitHub Pages non sta pubblicando la root.<br/>
        2) Se pagina ok ma avatar nero → errore JS o WebGL.<br/>
        3) In basso comparirà un riquadro rosso con l’errore preciso.
      </div>
      <div class="body">
        <label>Link Pages corretto</label>
        <input type="text" value="https://creamiaappsercuctech.github.io/Virtual-Stylist-3D/" readonly />
      </div>
    </div>
  </div>
</main>

<div id="errBox"></div>

<script type="module">
  const status = document.getElementById("status");
  const errBox = document.getElementById("errBox");
  function showErr(msg){
    errBox.style.display = "block";
    errBox.textContent = "ERRORE:\n" + msg;
    status.textContent = "Errore";
  }
  window.addEventListener("error", (e)=> showErr(e.message || String(e.error||e)));
  window.addEventListener("unhandledrejection", (e)=> showErr(String(e.reason||e)));

  import * as THREE from "https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.module.js";

  const threeWrap = document.getElementById("threeWrap");
  const renderer = new THREE.WebGLRenderer({ antialias:true, alpha:true });
  renderer.setPixelRatio(Math.min(2, window.devicePixelRatio||1));
  renderer.setSize(threeWrap.clientWidth, threeWrap.clientHeight);
  threeWrap.appendChild(renderer.domElement);

  const scene = new THREE.Scene();
  const camera = new THREE.PerspectiveCamera(45, threeWrap.clientWidth/threeWrap.clientHeight, 0.1, 100);
  camera.position.set(0, 1.55, 4.2);

  scene.add(new THREE.DirectionalLight(0xffffff, 1.0)).position.set(2,3,2);
  scene.add(new THREE.AmbientLight(0xffffff, 0.35));

  const floor = new THREE.Mesh(
    new THREE.CircleGeometry(2.0, 64),
    new THREE.MeshStandardMaterial({ color: 0x111118, roughness: 0.9, metalness: 0.1 })
  );
  floor.rotation.x = -Math.PI/2;
  scene.add(floor);

  function mat(hex, rough=0.8, metal=0.05){
    return new THREE.MeshStandardMaterial({ color: hex, roughness: rough, metalness: metal });
  }

  // Avatar parametrico (NO file esterni)
  const avatar = new THREE.Group();
  scene.add(avatar);

  const skinMat = mat(0xf0c8a8, 0.9, 0.0);
  const baseMat = mat(0x2a2a3a, 0.85, 0.05);
  const shirtMat = mat(0x1c2233, 0.9, 0.02);
  const pantsMat = mat(0x141a2b, 0.92, 0.02);
  const jacketMat = mat(0x2b2320, 0.8, 0.05);

  const head = new THREE.Mesh(new THREE.SphereGeometry(0.22, 32, 32), skinMat); head.position.y = 1.78;
  const neck = new THREE.Mesh(new THREE.CylinderGeometry(0.08, 0.10, 0.12, 20), skinMat); neck.position.y = 1.6;

  const torso = new THREE.Mesh(new THREE.CylinderGeometry(0.28, 0.34, 0.60, 24), baseMat); torso.position.y = 1.25;
  const pelvis = new THREE.Mesh(new THREE.CylinderGeometry(0.26, 0.30, 0.22, 24), baseMat); pelvis.position.y = 0.92;

  const armL = new THREE.Mesh(new THREE.CylinderGeometry(0.08, 0.10, 0.56, 20), skinMat);
  armL.position.set(-0.46, 1.28, 0); armL.rotation.z = 0.15;
  const armR = armL.clone(); armR.position.x = 0.46; armR.rotation.z = -0.15;

  const legL = new THREE.Mesh(new THREE.CylinderGeometry(0.11, 0.14, 0.78, 20), skinMat); legL.position.set(-0.17, 0.46, 0);
  const legR = legL.clone(); legR.position.x = 0.17;

  const footL = new THREE.Mesh(new THREE.BoxGeometry(0.18, 0.08, 0.34), mat(0x191922, 0.9, 0.05)); footL.position.set(-0.17, 0.06, 0.07);
  const footR = footL.clone(); footR.position.x = 0.17;

  const shirt = new THREE.Mesh(new THREE.CylinderGeometry(0.305, 0.365, 0.62, 24), shirtMat);
  shirt.position.copy(torso.position); shirt.scale.set(1.02,1.02,1.02);

  const pants = new THREE.Mesh(new THREE.CylinderGeometry(0.275, 0.315, 0.28, 24), pantsMat);
  pants.position.copy(pelvis.position); pants.position.y += 0.01; pants.scale.set(1.03,1.03,1.03);

  const jacket = new THREE.Group();
  const jacketBody = new THREE.Mesh(new THREE.CylinderGeometry(0.325, 0.385, 0.66, 24), jacketMat);
  jacketBody.position.copy(torso.position); jacketBody.scale.set(1.03,1.03,1.03);
  const sleeveL = new THREE.Mesh(new THREE.CylinderGeometry(0.10, 0.12, 0.58, 20), jacketMat);
  sleeveL.position.copy(armL.position); sleeveL.rotation.copy(armL.rotation);
  const sleeveR = sleeveL.clone(); sleeveR.position.x *= -1; sleeveR.rotation.z *= -1;
  jacket.add(jacketBody, sleeveL, sleeveR);
  jacket.visible = true;

  avatar.add(head, neck, torso, pelvis, armL, armR, legL, legR, footL, footR, shirt, pants, jacket);

  // Drag rotate
  let isDown=false, lastX=0, vel=0;
  renderer.domElement.addEventListener("pointerdown", (e)=>{ isDown=true; lastX=e.clientX; renderer.domElement.setPointerCapture(e.pointerId); });
  renderer.domElement.addEventListener("pointerup", ()=>{ isDown=false; });
  renderer.domElement.addEventListener("pointermove", (e)=>{
    if(!isDown) return;
    const dx=e.clientX-lastX; lastX=e.clientX;
    vel = dx*0.003;
    avatar.rotation.y += vel;
  });

  function resize(){
    const w=threeWrap.clientWidth, h=threeWrap.clientHeight;
    camera.aspect=w/h; camera.updateProjectionMatrix();
    renderer.setSize(w,h);
  }
  window.addEventListener("resize", resize);

  // Sliders
  const slShoulders = document.getElementById("slShoulders");
  const slWaist = document.getElementById("slWaist");
  const vShoulders = document.getElementById("vShoulders");
  const vWaist = document.getElementById("vWaist");
  const btnReset = document.getElementById("btnReset");

  function rebuild(shouldersCm, waistCm){
    vShoulders.textContent = shouldersCm;
    vWaist.textContent = waistCm;

    const s = (shouldersCm - 44) / 20;
    const w = (waistCm - 86) / 40;

    const torsoTop = 0.34 * (1 + s*0.55);
    const torsoBot = 0.28 * (1 + w*0.35);
    torso.geometry.dispose();
    torso.geometry = new THREE.CylinderGeometry(torsoBot, torsoTop, 0.60, 24);

    shirt.geometry.dispose();
    shirt.geometry = new THREE.CylinderGeometry(torsoBot*1.08, torsoTop*1.08, 0.62, 24);

    jacketBody.geometry.dispose();
    jacketBody.geometry = new THREE.CylinderGeometry(torsoBot*1.14, torsoTop*1.14, 0.66, 24);

    const pelvisTop = 0.30 * (1 + w*0.35);
    const pelvisBot = 0.26 * (1 + w*0.25);
    pelvis.geometry.dispose();
    pelvis.geometry = new THREE.CylinderGeometry(pelvisBot, pelvisTop, 0.22, 24);

    pants.geometry.dispose();
    pants.geometry = new THREE.CylinderGeometry(pelvisBot*1.06, pelvisTop*1.06, 0.28, 24);

    const armX = 0.46 * (1 + s*0.55);
    armL.position.x = -armX; armR.position.x = armX;
    sleeveL.position.x = armL.position.x;
    sleeveR.position.x = armR.position.x;
  }

  function applyFromUI(){
    rebuild(Number(slShoulders.value), Number(slWaist.value));
  }
  slShoulders.addEventListener("input", applyFromUI);
  slWaist.addEventListener("input", applyFromUI);
  btnReset.addEventListener("click", ()=>{
    slShoulders.value = 44;
    slWaist.value = 86;
    applyFromUI();
  });

  applyFromUI();
  status.textContent = "OK";

  function animate(){
    requestAnimationFrame(animate);
    avatar.rotation.y += vel*0.15;
    vel *= 0.88;
    renderer.render(scene,camera);
  }
  animate();
</script>
</body>
</html>
